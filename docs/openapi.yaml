openapi: 3.0.3
info:
  title: Hotel Booking API - Team 12
  description: |-
    RESTful backend cho hệ thống đặt phòng khách sạn với 3 vai trò: Admin, Owner, Guest.
    Final Project - ITIS 4166/5166 - UNC Charlotte
  version: 1.0.0
  contact:
    name: Team 12
    email: team12-hotel-booking@example.com

servers:
  - url: https://your-api.onrender.com/api
    description: Production server
  - url: http://localhost:3000/api
    description: Local development server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 7
        name:
          type: string
          example: "Hemanth Pasupula"
        email:
          type: string
          format: email
          example: "h@example.com"
        role:
          type: string
          enum: [ADMIN, OWNER, GUEST]
          example: GUEST
        password:
          type: string
          writeOnly: true
          example: "123456"

    Hotel:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        city:
          type: string
        address:
          type: string
        rating:
          type: number
          format: float
          minimum: 0
          maximum: 5
        ownerId:
          type: integer
          nullable: true

    Room:
      type: object
      properties:
        id:
          type: integer
        hotelId:
          type: integer
        roomNumber:
          type: string
        capacity:
          type: integer
        pricePerNight:
          type: number
          format: float
        amenities:
          type: array
          items:
            type: string
        isPublished:
          type: boolean
          default: true

    Booking:
      type: object
      properties:
        id:
          type: integer
        roomId:
          type: integer
        userId:
          type: integer
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        guests:
          type: integer
        status:
          type: string
          enum: [BOOKED, CANCELED]
          default: BOOKED
        total:
          type: number
          format: float

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
        error:
          type: string

  parameters:
    hotelId:
      name: hotelId
      in: path
      required: true
      schema:
        type: integer
    roomId:
      name: roomId
      in: path
      required: true
      schema:
        type: integer
    bookingId:
      name: bookingId
      in: path
      required: true
      schema:
        type: integer

security:
  - bearerAuth: []

paths:
  # ====================== AUTH ======================
  /auth/signup:
    post:
      summary: Register new user (default role = GUEST)
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name: { type: string }
                email: { type: string, format: email }
                password: { type: string, minLength: 6 }
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Invalid input or email already exists

  /auth/login:
    post:
      summary: Login and receive JWT
      tags: [Auth]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: { type: string }
                  accessToken: { type: string }
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials

  # ====================== HOTELS ======================
  /hotels:
    post:
      summary: Create new hotel (Admin only)
      tags: [Hotels]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, city, address]
              properties:
                name: { type: string }
                city: { type: string }
                address: { type: string }
                rating: { type: number }
      responses:
        '201':
          description: Hotel created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Hotel'

    get:
      summary: Get hotels (Admin → all, Owner → owned only)
      tags: [Hotels]
      responses:
        '200':
          description: List of hotels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Hotel'

  /admin/hotels:
    get:
      summary: Get ALL hotels (Admin only)
      tags: [Hotels]
      responses:
        '200':
          description: All hotels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Hotel'

  /owner/hotels:
    get:
      summary: Get hotels owned by current user (Owner only)
      tags: [Hotels]
      responses:
        '200':
          description: Owned hotels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Hotel'

  /hotels/{hotelId}:
    patch:
      summary: Update hotel (Admin or Owner of that hotel)
      tags: [Hotels]
      parameters:
        - $ref: '#/components/parameters/hotelId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                city: { type: string }
                address: { type: string }
                rating: { type: number }
      responses:
        '200':
          description: Hotel updated

    delete:
      summary: Delete hotel (Admin only)
      tags: [Hotels]
      parameters:
        - $ref: '#/components/parameters/hotelId'
      responses:
        '204':
          description: Hotel deleted (if no active bookings)

  /hotels/{hotelId}/owner:
    patch:
      summary: Assign / transfer hotel ownership (Admin only)
      tags: [Hotels]
      parameters:
        - $ref: '#/components/parameters/hotelId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [ownerId]
              properties:
                ownerId:
                  type: integer
      responses:
        '200':
          description: Ownership updated

  # ====================== ROOMS ======================
  /hotels/{hotelId}/rooms:
    post:
      summary: Add room to hotel (Admin or Owner of hotel)
      tags: [Rooms]
      parameters:
        - $ref: '#/components/parameters/hotelId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [roomNumber, capacity, pricePerNight]
              properties:
                roomNumber: { type: string }
                capacity: { type: integer }
                pricePerNight: { type: number }
                amenities: { type: array, items: { type: string } }
      responses:
        '201':
          description: Room created

  /rooms:
    get:
      summary: Public room search (filters supported)
      tags: [Rooms]
      security: []
      parameters:
        - name: city
          in: query
          schema: { type: string }
        - name: capacity
          in: query
          schema: { type: integer }
        - name: priceMin
          in: query
          schema: { type: number }
        - name: priceMax
          in: query
          schema: { type: number }
        - name: startDate
          in: query
          schema: { type: string, format: date }
        - name: endDate
          in: query
          schema: { type: string, format: date }
      responses:
        '200':
          description: List of available rooms
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Room'

  /rooms/{roomId}:
    get:
      summary: Get room details (public)
      tags: [Rooms]
      security: []
      parameters:
        - $ref: '#/components/parameters/roomId'
      responses:
        '200':
          description: Room details

    patch:
      summary: Update room (Admin or Owner)
      tags: [Rooms]
      parameters:
        - $ref: '#/components/parameters/roomId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                pricePerNight: { type: number }
                capacity: { type: integer }
                amenities: { type: array, items: { type: string } }
      responses:
        '200':
          description: Room updated

    delete:
      summary: Delete room (Admin or Owner)
      tags: [Rooms]
      parameters:
        - $ref: '#/components/parameters/roomId'
      responses:
        '204':
          description: Room deleted (blocked if future bookings exist)

  # ====================== BOOKINGS ======================
  /bookings:
    post:
      summary: Create new booking (Guest only)
      tags: [Bookings]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [roomId, startDate, endDate, guests]
              properties:
                roomId: { type: integer }
                startDate: { type: string, format: date }
                endDate: { type: string, format: date }
                guests: { type: integer }
      responses:
        '201':
          description: Booking created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Booking'

    get:
      summary: Get bookings (scoped by role)
      tags: [Bookings]
      responses:
        '200':
          description: |
            Guest → own bookings
            Owner → bookings of their hotels
            Admin → all bookings

  /owner/bookings:
    get:
      summary: Get bookings for owned hotels (Owner only)
      tags: [Bookings]
      parameters:
        - name: hotelId
          in: query
          schema: { type: integer }
      responses:
        '200':
          description: Bookings in owned hotels

  /admin/bookings:
    get:
      summary: Get all bookings (Admin only)
      tags: [Bookings]
      responses:
        '200':
          description: All bookings in system

  /bookings/{bookingId}:
    patch:
      summary: Update booking dates/guests (Guest only, before start date)
      tags: [Bookings]
      parameters:
        - $ref: '#/components/parameters/bookingId'
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                startDate: { type: string, format: date }
                endDate: { type: string, format: date }
                guests: { type: integer }
      responses:
        '200':
          description: Booking updated

  /bookings/{bookingId}/cancel:
    patch:
      summary: Cancel booking (soft cancel) - Guest/Owner/Admin
      tags: [Bookings]
      parameters:
        - $ref: '#/components/parameters/bookingId'
      responses:
        '200':
          description: Booking status → CANCELED

  /bookings/{bookingId}:
    delete:
      summary: Hard delete booking (Admin only)
      tags: [Bookings]
      parameters:
        - $ref: '#/components/parameters/bookingId'
      responses:
        '204':
          description: Booking permanently deleted

  # ====================== USERS ======================
  /admin/users:
    get:
      summary: Get all users (Admin only)
      tags: [Users]
      responses:
        '200':
          description: All users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

  /owner/hotels/{hotelId}/guests:
    get:
      summary: Get guests who booked in specific hotel (Owner only)
      tags: [Users]
      parameters:
        - $ref: '#/components/parameters/hotelId'
      responses:
        '200':
          description: List of guests

  /users/me:
    patch:
      summary: Update own profile
      tags: [Users]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                password: { type: string }
      responses:
        '200':
          description: Profile updated

    delete:
      summary: Delete own account (soft delete recommended)
      tags: [Users]
      responses:
        '204':
          description: Account deleted

tags:
  - name: Auth
  - name: Hotels
  - name: Rooms
  - name: Bookings
  - name: Users