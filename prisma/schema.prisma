generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  OWNER
  GUEST
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
}

model User {
  id       Int     @id @default(autoincrement())
  name     String?
  email    String  @unique
  password String
  role     Role    @default(GUEST)

  hotels   Hotel[]   @relation("OwnerHotels")
  bookings Booking[] @relation("GuestBookings")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Hotel {
  id          Int     @id @default(autoincrement())
  ownerId     Int?
  name        String
  city        String
  address     String
  rating      Float?
  isPublished Boolean @default(false)

  owner User?  @relation("OwnerHotels", fields: [ownerId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  rooms Room[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([ownerId])
  @@map("hotels")
}

model Room {
  id            Int     @id @default(autoincrement())
  hotelId       Int
  roomNumber    Int
  capacity      Int
  pricePerNight Decimal @db.Decimal(10, 2)
  isPublished   Boolean @default(false)

  hotel    Hotel     @relation(fields: [hotelId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  bookings Booking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([hotelId, roomNumber])
  @@index([hotelId])
  @@map("rooms")
}

model Booking {
  id        Int           @id @default(autoincrement())
  roomId    Int
  guestId   Int
  startDate DateTime
  endDate   DateTime
  guests    Int
  status    BookingStatus @default(CONFIRMED)
  total     Decimal       @db.Decimal(10, 2)

  room  Room @relation(fields: [roomId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  guest User @relation("GuestBookings", fields: [guestId], references: [id], onDelete: Restrict, onUpdate: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([guestId])
  @@index([roomId, startDate, endDate])
  @@map("bookings")
}
