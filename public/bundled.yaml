openapi: 3.1.0
info:
  title: Hotel Booking API – Team 12
  description: Final Project ITIS 4166/5166 – Hemanth, Sriya, Thanh
  version: 1.0.0
servers:
  - url: http://localhost:3000/api
    description: Local development server
  - url: https://hotel-booking-api-mv9b.onrender.com/api
    description: Production server on render
security:
  - bearerAuth: []
tags:
  - name: Auth
  - name: Hotels
  - name: Rooms
  - name: Bookings
  - name: Users
paths:
  /auth/signup:
    post:
      summary: Register a new user (default role GUEST)
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
              properties:
                name:
                  type: string
                  example: Hemanth
                email:
                  type: string
                  format: email
                  example: he@gmail.com
                password:
                  type: string
                  format: password
                  example: 123456789
                  minLength: 4
      responses:
        '201':
          description: User created successfully
          $ref: '#/components/responses/201'
        '400':
          $ref: '#/components/responses/400'
  /auth/login:
    post:
      summary: Login and receive JWT token
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/400'
        '401':
          $ref: '#/components/responses/401'
  /hotels:
    post:
      summary: Create new hotel (Admin only)
      tags:
        - Hotels
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HotelCreate'
      responses:
        '201':
          $ref: '#/components/responses/201'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
  /hotels/{id}:
    patch:
      summary: Update hotel details (Admin or Owner)
      tags:
        - Hotels
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HotelUpdate'
      responses:
        '200':
          $ref: '#/components/responses/200'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '404':
          $ref: '#/components/responses/404'
    delete:
      summary: Delete hotel (Admin only)
      tags:
        - Hotels
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          example: 1
      responses:
        '204':
          description: Hotel deleted
        '403':
          $ref: '#/components/responses/403'
        '404':
          $ref: '#/components/responses/404'
  /hotels/{id}/owner:
    patch:
      summary: Assign or transfer hotel owner (Admin only)
      tags:
        - Hotels
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ownerId:
                  type: integer
                  nullable: true
                  example: 5
      responses:
        '200':
          $ref: '#/components/responses/200'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
  /admin/hotels:
    get:
      summary: Get all hotels (Admin only)
      tags:
        - Hotels
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of all hotels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HotelResponse'
        '403':
          $ref: '#/components/responses/403'
  /owner/hotels:
    get:
      summary: Get hotels owned by current user (Owner only)
      tags:
        - Hotels
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Owned hotels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/HotelResponse'
        '403':
          $ref: '#/components/responses/403'
  /rooms:
    get:
      summary: Get all available rooms (Public – supports filters)
      tags:
        - Rooms
      parameters:
        - name: city
          in: query
          schema:
            type: string
        - name: minCapacity
          in: query
          schema:
            type: integer
        - name: maxPrice
          in: query
          schema:
            type: number
      responses:
        '200':
          description: List of rooms
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RoomPublic'
  /rooms/{id}:
    get:
      summary: Get room by ID (Public)
      tags:
        - Rooms
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RoomPublic'
        '404':
          $ref: '#/components/responses/404'
    patch:
      summary: Update room (Admin or Owner)
      tags:
        - Rooms
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomUpdate'
      responses:
        '200':
          $ref: '#/components/responses/200'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
    delete:
      summary: Delete room (Admin or Owner)
      tags:
        - Rooms
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Room deleted
        '403':
          $ref: '#/components/responses/403'
  /hotels/{hotelId}/rooms:
    post:
      summary: Add room to hotel (Admin or Owner)
      tags:
        - Rooms
      security:
        - bearerAuth: []
      parameters:
        - name: hotelId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoomCreate'
      responses:
        '201':
          $ref: '#/components/responses/201'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
  /bookings:
    post:
      summary: Create new booking (Guest only)
      tags:
        - Bookings
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingCreate'
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingResponse'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
    get:
      summary: Get current user's bookings
      tags:
        - Bookings
      security:
        - bearerAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BookingResponse'
  /bookings/{id}:
    patch:
      summary: Update booking dates/guests (before start date)
      tags:
        - Bookings
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BookingUpdate'
      responses:
        '200':
          $ref: '#/components/responses/200'
        '400':
          $ref: '#/components/responses/400'
        '403':
          $ref: '#/components/responses/403'
        '404':
          $ref: '#/components/responses/404'
  /bookings/{id}/cancel:
    patch:
      summary: Cancel booking (soft cancel – User/Owner/Admin)
      tags:
        - Bookings
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Booking canceled
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum:
                      - CANCELED
        '403':
          $ref: '#/components/responses/403'
        '404':
          $ref: '#/components/responses/404'
  /owner/bookings:
    get:
      summary: Get bookings for owned hotels (Owner)
      tags:
        - Bookings
      security:
        - bearerAuth: []
      parameters:
        - name: hotelId
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Bookings in owned hotels
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BookingResponse'
  /admin/bookings:
    get:
      summary: Get all bookings (Admin only)
      tags:
        - Bookings
      security:
        - bearerAuth: []
      responses:
        '200':
          description: All bookings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BookingResponse'
        '403':
          $ref: '#/components/responses/403'
  /users/me:
    patch:
      summary: Update own profile
      tags:
        - Users
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                password:
                  type: string
                  format: password
      responses:
        '200':
          $ref: '#/components/responses/200'
    delete:
      summary: Delete own account (soft delete recommended)
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Account deleted
  /admin/users:
    get:
      summary: Get all users (Admin only)
      tags:
        - Users
      security:
        - bearerAuth: []
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '403':
          $ref: '#/components/responses/403'
  /owner/hotels/{hotelId}/guests:
    get:
      summary: Get guests who booked in a specific owned hotel
      tags:
        - Users
      security:
        - bearerAuth: []
      parameters:
        - name: hotelId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '403':
          $ref: '#/components/responses/403'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  responses:
    '200':
      description: Successful operation
      content:
        application/json:
          schema:
            type: object
            properties:
              data: {}
    '201':
      description: Resource created successfully
      content:
        application/json:
          schema:
            type: object
            properties:
              data: {}
              message:
                type: string
                example: Resource created successfully
    '400':
      description: Bad Request – Invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    '401':
      description: Unauthorized – Missing or invalid token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    '403':
      description: Forbidden – Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    '404':
      description: Not Found – Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    OK:
      $ref: '#/components/responses/200'
    Created:
      $ref: '#/components/responses/201'
    BadRequest:
      $ref: '#/components/responses/400'
    Unauthorized:
      $ref: '#/components/responses/401'
    Forbidden:
      $ref: '#/components/responses/403'
    NotFound:
      $ref: '#/components/responses/404'
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
      required:
        - error
        - message
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum:
            - ADMIN
            - OWNER
            - GUEST
          default: GUEST
    HotelCreate:
      type: object
      required:
        - name
        - city
        - address
      properties:
        name:
          type: string
          example: Skyline Resort
        city:
          type: string
          example: Charlotte
        address:
          type: string
          example: 100 Lake Drive
        rating:
          type: number
          minimum: 0
          maximum: 5
          example: 4.8
    HotelUpdate:
      type: object
      properties:
        name:
          type: string
        city:
          type: string
        address:
          type: string
        rating:
          type: number
          minimum: 0
          maximum: 5
    HotelResponse:
      type: object
      required:
        - id
        - name
        - city
        - address
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Skyline Resort
        city:
          type: string
          example: Charlotte
        address:
          type: string
          example: 100 Lake Drive
        rating:
          type: number
          example: 4.8
        ownerId:
          type: integer
          nullable: true
          example: 5
        createdAt:
          type: string
          format: date-time
          example: '2025-04-05T10:00:00Z'
    RoomCreate:
      type: object
      required:
        - roomNumber
        - capacity
        - pricePerNight
      properties:
        roomNumber:
          type: string
          example: '402'
        capacity:
          type: integer
          minimum: 1
          example: 3
        pricePerNight:
          type: number
          minimum: 0
          example: 159
        amenities:
          type: array
          items:
            type: string
          example:
            - WiFi
            - TV
            - Mini-fridge
    RoomUpdate:
      type: object
      properties:
        roomNumber:
          type: string
        capacity:
          type: integer
          minimum: 1
        pricePerNight:
          type: number
          minimum: 0
        amenities:
          type: array
          items:
            type: string
    RoomPublic:
      type: object
      required:
        - id
        - roomNumber
        - capacity
        - pricePerNight
      properties:
        id:
          type: integer
          example: 312
        roomNumber:
          type: string
          example: '402'
        capacity:
          type: integer
          example: 3
        pricePerNight:
          type: number
          example: 159
        amenities:
          type: array
          items:
            type: string
          example:
            - WiFi
            - TV
            - Mini-fridge
        hotel:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
              example: Skyline Resort
            city:
              type: string
              example: Charlotte
    BookingCreate:
      type: object
      required:
        - roomId
        - startDate
        - endDate
        - guests
      properties:
        roomId:
          type: integer
          example: 312
        startDate:
          type: string
          format: date
          example: '2025-12-10'
        endDate:
          type: string
          format: date
          example: '2025-12-15'
        guests:
          type: integer
          minimum: 1
          maximum: 10
          example: 2
    BookingUpdate:
      type: object
      properties:
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        guests:
          type: integer
          minimum: 1
    BookingResponse:
      type: object
      required:
        - id
        - roomId
        - userId
        - startDate
        - endDate
        - guests
        - total
        - status
      properties:
        id:
          type: integer
          example: 25
        roomId:
          type: integer
        userId:
          type: integer
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        guests:
          type: integer
        total:
          type: number
          example: 795
        status:
          type: string
          enum:
            - BOOKED
            - CANCELED
          default: BOOKED
        createdAt:
          type: string
          format: date-time
